Recursive-descent Textile parser in Ruby

link-rule:
  | image-rule ':' url
  | quote-rule ':' url
  : image-rule
  ;

image-rule:
  | '!' quote-rule '!'
  : quote-rule
  ;

quote-rule:
  | '"' terminal '"'
  : terminal
  ;

terminal:
  | word | space
  | '*' link-rule '*'
  | '^' link-rule '^'
  | '+' link-rule '+'
  | '-' link-rule '-'
  | '_' link-rule '_'
  | '@' link-rule '@'
  | '~' link-rule '~'
  | pre-rule | spoiler-rule | bq-rule | raw-rule
  : *
  ;

spoiler-rule:
  | '[spoiler]' link-rule '[/spoiler]'
  ;

pre-rule:
  | '[pre]' link-rule '[/pre]'
  ;

bq-rule:
  | '[bq]' link-rule '[/bq]'
  | '[bq="*"]' link-rule '[/bq]'
  ;

raw-rule:
  | '[==' terminal '==]'
  | '==' terminal '=='
  ;
